$schema: "http://json-schema.org/draft-07/schema#"

description: Various definitions

type: object

definitions:

  ##############################
  # Atomic properties for reuse in object properties
  ##############################

  options:
    description: program options represented as string, array or dictionary
    type: [string, array, object]
    items:
      type: string
    uniqueItems: true
  envmodules:
    description: environment module list
    type: array
    items:
      type: string
    uniqueItems: true
  runtime:
    description: rule runtime in minutes
    type: integer
  threads:
    description: number of threads
    type: integer
  mem_mb:
    description: Resource that defines assigned memory in megabases
    type: integer
  java_options:
    description: options to pass to java interpreter
    type: string
  java_tmpdir:
    description: java temporary directory
    type: string
  step_size:
    description: step size
    type: array
    minItems: 1
    items:
      type: integer
  window_size:
    description: window size
    type: array
    minItems: 1
    items:
      type: integer
  ids:
    description: generic property to list identifiers
    type: array
    items:
      type: string
    uniqueItems: true

  ##############################
  # Default resources
  ##############################

  resources.default:
    title: Default resources.
    description: >
      Default resources. Any rule that does not specify resources will
      fall back on these default values.
    type: object
    default: {}
    properties:
      threads:
        $ref: "#/definitions/threads"
        default: 1
      mem_mb:
        $ref: "#/definitions/mem_mb"
        default: 8192
      runtime:
        $ref: "#/definitions/runtime"
        default: 120
      options:
        $ref: "#/definitions/options"
        default: ""
      envmodules:
        $ref: "#/definitions/envmodules"
        default: []
      java_options:
        $ref: "#/definitions/java_options"
        default: ""
      java_tmpdir:
        $ref: "#/definitions/java_tmpdir"
        default: "/tmp"
    additionalProperties: false

  ##############################
  # Rule definitions
  ##############################

  rule.config:
    title: Rule configuration
    description: generic configuration for rules
    type: object
    properties:
      options:
        $ref: "#/definitions/options"
      envmodules:
        $ref: "#/definitions/envmodules"
      threads:
        $ref: "#/definitions/threads"
      mem_mb:
        $ref: "#/definitions/mem_mb"
      runtime:
        $ref: "#/definitions/runtime"


  ##############################
  # Java rule
  ##############################

  rule.java.config:
    title: Java rule configuration
    description: generic configuration for java rules
    type: object
    properties:
      options:
        $ref: "#/definitions/options"
      envmodules:
        $ref: "#/definitions/envmodules"
      threads:
        $ref: "#/definitions/threads"
      mem_mb:
        $ref: "#/definitions/mem_mb"
      runtime:
        $ref: "#/definitions/runtime"
      java_options:
        $ref: "#/definitions/java_options"
      java_tmpdir:
        $ref: "#/definitions/java_tmpdir"


  ##############################
  # Windowed rule
  ##############################

  rule.window.config:
    title: Windowed rule configuration
    description: generic configuration for rules that do sliding window analyses
    type: object
    properties:
      options:
        $ref: "#/definitions/options"
      envmodules:
        $ref: "#/definitions/envmodules"
      threads:
        $ref: "#/definitions/threads"
      mem_mb:
        $ref: "#/definitions/mem_mb"
      runtime:
        $ref: "#/definitions/runtime"
      step_size:
        $ref: "#/definitions/step_size"
      window_size:
        $ref: "#/definitions/window_size"



  ##############################
  # Resources configurations
  #
  # NB: resources hold both resource configs as well as rule configs
  # (e.g. options)
  ##############################
  rules.config:
    type: object
    patternProperties:
      ^(busco_run)$:
        description: busco rule resources
        $ref: "definitions.schema.yaml#/definitions/rule.config"
        #$ref: "/home/peru/dev/snakemake-workflows/snakemake-schema/definitions.schema.yaml#/definitions/rule.config"
      ^(genecovr_make_csv_inputfile|genecovr_run)$:
        description: genecovr rule resources
        $ref: "definitions.schema.yaml#/definitions/rule.config"
      ^(gmap_build|gmap_map):
        description: gmap rule resources
        $ref: "definitions.schema.yaml#/definitions/rule.config"
      ^(jellyfish_count_chunk|jellyfish_make_chunked_input|jellyfish_histo|jellyfish_kmer_count_pairs|jellyfish_kmers_plot|jellyfish_merge)$:
        description: jellyfish rule resources
        $ref: "definitions.schema.yaml#/definitions/rule.config"
      ^(kraken2_parallel|kraken2_gather_reports|kraken2_gather_results)$:
        description: kraken rule resources
        $ref: "definitions.schema.yaml#/definitions/rule.config"
      ^(assemblyeval_samtools_faidx|multiqc)$:
        description: miscellaneous resource configurations
        $ref: "definitions.schema.yaml#/definitions/rule.config"
      ^(quast)$:
        description: quast rule resources
        $ref: "definitions.schema.yaml#/definitions/rule.config"
      ^(repeatmasker_chunk|repeatmasker_make_chunked_input)$:
        description: repeatmasker rule resources
        $ref: "definitions.schema.yaml#/definitions/rule.config"


  ##############################
  # File system layout
  ##############################

  fs:
    type: object
    description: >
        file system layout; defines Path objects and wildcards for
        snakemake rules
    default: {}
    properties:
      external:
        type: string
        default: data/external
      interim:
        type: string
        default: data/interim
      metadata:
        type: string
        default: data/metadata
      raw:
        type: string
        default: data/raw
      reports:
        type: string
        default: reports
      resources:
        type: string
        default: resources
      results:
        type: string
        default: results

  ##############################
  # Analysis set
  ##############################
  analysis:
    type: object
    properties:
      description:
        type: string
      label:
        type: string
      read_ids:
        $ref: "#/definitions/ids"
        description: read ids
      assembly_ids:
        $ref: "#/definitions/ids"
        description: assembly ids
      transcript_ids:
        $ref: "#/definitions/ids"
        description: transcript ids
      tools:
        $ref: "tools.schema.yaml#/definitions/tools.config"

      rules:
        $ref: "#/definitions/rules.config"
    additionalProperties: false
    required:
      - assembly_ids
